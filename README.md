# 艾宾浩斯遗忘曲线记忆小程序

## 项目简介

本项目是基于微信小程序平台开发的知识记忆与复习工具，核心理念源自艾宾浩斯遗忘曲线与SM-2算法。用户可将知识点以"分组"方式管理，通过科学的复习计划，最大化记忆效率。支持知识点的批量导入、分组管理、复习进度追踪等功能。

## 核心功能

### 🗂️ 分组管理
- 创建和删除知识分组
- 实时显示每个分组的待复习知识点数量
- 所有分组与知识点数据完全本地存储，保护用户隐私

### 📥 知识导入
- 支持两种导入方式：
  1. **文本输入**：手动输入知识点（问题|||答案格式）
  2. **JSON文件导入**：支持包含多媒体内容的数组对象格式。
- **分批处理机制**：支持大数据量导入，避免界面卡顿
- 进度显示：实时显示导入进度

#### JSON 文件格式说明

**推荐格式：数组对象（支持多媒体）**
此格式功能最全，支持为每个知识点添加图片或音频。`media` 字段为可选。

```json
[
  {
    "question": "太阳的颜色是什么？",
    "answer": "黄色",
    "media": [
      { "type": "image", "url": "https://example.com/sun.jpg" }
    ]
  },
  {
    "question": "请听音频，回答内容",
    "answer": "音频内容",
    "media": [
      { "type": "audio", "url": "https://example.com/audio.mp3" }
    ]
  },
  {
    "question": "没有媒体的问题",
    "answer": "没有媒体的答案"
  }
]
```

### 🔁 智能复习系统
- **混合SM-2间隔算法**：新知识点前几次复习采用更短间隔，之后进入SM-2个性化间隔。
  - 反馈分为三档：记住了（5分）、模糊（3分）、没记住（1分）。
  - 没记住：下次复习间隔重置为5分钟。
  - 第1次记住：5分钟后复习
  - 第2次记住：30分钟后复习
  - 第3次记住：12小时后复习
  - 第4次记住：1天后复习
  - 第5次记住：6天后复习
  - 第6次及以后：上次间隔×efactor（四舍五入为整数天，efactor初始2.5，最低1.3，动态调整）
  - efactor = efactor + (0.1 - (5 - 反馈分数) × (0.08 + (5 - 反馈分数) × 0.02))，最低1.3
- **每日批次限制**：每组每天最多复习20个知识点，优先推送到期知识点，不足补未复习知识点
- **三种知识点状态**：
  - `pending`：等待首次复习
  - `reviewing`：复习中
  - `mastered`：已掌握
- **自动进度跟踪**：记录每次复习结果和下次复习时间

### 📊 复习统计与可视化
- 实时显示当前复习进度
- 复习历史次数与反馈分数统计
- 显示上次复习时间间隔

## 技术实现

### 存储架构
采用**分组-知识点索引分离模型**解决本地存储限制：
```mermaid
graph TD
    A[分组元数据] --> B[groups]
    C[知识点索引] --> D[group-id]
    E[知识点详情] --> F[knowledge-id]
```

**核心数据结构**：
```javascript
// 知识点对象结构
{
  id: Number,           // 唯一ID
  question: String,     // 问题
  answer: String,       // 答案
  groupId: Number,      // 所属分组ID
  addTime: Number,      // 添加时间戳
  nextReviewTime: Number, // 下次复习时间
  reviewCount: Number,  // 复习次数
  history: Array,       // 复习历史 [{time, quality, interval, efactor}]
  status: String,       // 状态: pending/reviewing/mastered
  lastInterval: Number, // 上一次复习间隔（天）
  media: Array,         // 媒体资源（可选）
  learned: Boolean,     // 是否纳入复习
  efactor: Number,      // SM-2算法因子
  interval: Number,     // 当前间隔（天）
  repetition: Number    // 连续记住次数
}
```

**分组对象结构**：
```javascript
{
  id: Number,           // 唯一ID
  name: String,         // 分组名
  knowledgeCount: Number, // 知识点数量
  dueCount: Number,     // 待复习数量
  learnedCount: Number, // 已学会数量
  unmasteredCount: Number, // 未掌握数量
  createTime: Number    // 创建时间戳
}
```

### 复习算法流程
```mermaid
graph TD
    A[加载分组] --> B{今日批次已生成?}
    B -->|是| C[获取待复习知识点]
    B -->|否| D[生成今日批次]
    C --> E[显示第一个知识点]
    E --> F{用户选择记得/模糊/没记住}
    F -->|记得/模糊| G[更新复习次数和间隔]
    F -->|没记住| H[重置复习状态]
    G --> I{repetition≥5 且 efactor≥2.5?}
    I -->|是| J[标记为已掌握]
    I -->|否| K[计算下次复习时间]
    H --> K
    J --> L[更新存储]
    K --> L
    L --> M[自动下一题]
```

### 复习算法说明

本小程序采用基于艾宾浩斯遗忘曲线的**SM-2混合间隔算法**，每个知识点有efactor、interval、repetition等字段，具体如下：

- 反馈分数（quality）：5=记住了，3=模糊，1=没记住
- 前5次复习间隔分别为5分钟、30分钟、12小时、1天、6天
- 第6次及以后：上次间隔×efactor（四舍五入为整数天）
- efactor初始2.5，最低1.3，按如下公式动态调整：
  ```
  efactor = efactor + (0.1 - (5 - 反馈分数) × (0.08 + (5 - 反馈分数) × 0.02))
  efactor >= 1.3
  ```
- 只要一次没记住，间隔重置为5分钟，efactor下降
- 每日批次最多20条，优先推送到期知识点，不足补未复习知识点
- 复习历史记录结构：
  - 复习时间（time）
  - 反馈分数（quality）
  - 间隔（interval，天）
  - efactor

> **切换为"已掌握"条件说明：**
> - 只有当某知识点连续5次记住（repetition≥5），且efactor≥2.5时，才会被标记为"已掌握"（mastered），不再进入常规复习队列。
> - 该条件比单纯"复习次数达标"更严格，确保只有真正熟练且记忆强度高的知识点才会被判定为已掌握。

### 文件结构
```
├── app.js               # 小程序入口
├── app.json             # 全局配置
├── README.md            # 项目文档
├── components/          # 可复用组件
│   ├── navigation-bar/  # 自定义导航栏
│   └── icons/           # 图标资源
├── i18n/                # 国际化资源
│   └── base.json        # 基础语言包
├── miniapp/             # 平台特定资源
├── pages/               # 页面组件
│   ├── groups/          # 分组管理
│   ├── import/          # 知识导入
│   ├── review/          # 复习功能
│   ├── mastered/        # 已掌握知识
│   └── index/           # 首页
└── utils/
    └── storage.js       # 数据存储核心逻辑
```

## 界面预览
```mermaid
graph TD
    A[分组选择] --> B[复习界面]
    B --> C{显示问题}
    C --> D[记忆反馈按钮]
    D --> E[用户答题]
    E --> F{记住/模糊/没记住?}
    F -->|记住/模糊| G[更新复习次数和间隔]
    F -->|没记住| H[重置复习状态]
    G --> I[更新间隔]
    H --> I
```

## 快速开始

### 开发环境
1. 安装微信开发者工具
2. 克隆项目仓库
3. 导入项目目录
4. 点击"编译"预览小程序

### 使用指南
1. **创建分组**：在分组页面输入名称并添加
2. **导入知识**：
   - 文本输入：在输入框按`问题|||答案`格式输入
   - 文件导入：选择JSON格式的知识点文件
3. **开始复习**：
   - 进入分组点击"复习"
   - 根据记忆情况选择"记住了"、"模糊"或"没记住"
   - 系统自动安排下次复习时间

## 维护与扩展
- **存储模块**：所有数据操作封装在`utils/storage.js`
- **算法调整**：修改`utils/storage.js`中的`updateKnowledgeBySM2`函数
- **UI定制**：通过WXSS文件调整样式
- **性能优化**：使用全局缓存减少存储读取

## 注意事项
1. 所有数据存储在本地，卸载小程序将丢失数据
2. 每日复习批次在凌晨自动重置
3. 已掌握知识点可在"已掌握"页面查看

---

> 本项目核心复习算法以SM-2为主，主逻辑以efactor、repetition等字段为准。

### 分组统计与数据一致性

- 每个分组对象维护如下统计字段，所有页面只读这些字段，极大提升性能和一致性：
  - `dueCount`：待复习知识点数量（即今日批次中 nextReviewTime <= now 的 learned 且未掌握知识点数）
  - `learnedCount`：已学会知识点数量（learned === true）
  - `unmasteredCount`：未掌握知识点数量（learned === true 且 status !== 'mastered'）
- 统计字段仅在知识点变动时通过 `updateGroupStats` 自动更新，避免全量遍历。
- 所有页面、定时器、复习流程均以 reviewList 为唯一数据源，保证各页面数据一致。
- 定时器机制保证即使页面不重载，dueCount 也能自动刷新。

