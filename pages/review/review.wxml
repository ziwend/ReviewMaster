<view class="container review-container">

  <!-- 加载中状态 -->
  <view wx:if="{{loading}}" class="loading">加载中...</view>

  <!-- 复习卡片 -->
  <block wx:elif="{{current}}">
    <view class="review-header">
      <view class="page-title">{{currentGroup.name}}</view>
      <view class="stat-bar">
        <view class="stat-row main-row">
          <text>第{{currentIndex+1}}/{{reviewList.length}}题</text>
          <block wx:if="{{current.lastRememberAgo}}">
            <text class="last-remember-label">最后记住：{{current.lastRememberAgo}}</text>
          </block>
          <text class="memory-strength-label-inline">记忆强度：{{current.memoryStrength}}%</text>
        </view>
        <view class="memory-indicator-bar">
          <view class="memory-strength-bar" style="width: {{current.memoryStrength}}%;"></view>
        </view>
      </view>
    </view>
    <view class="review-card card">
      <block wx:if="{{!showResult}}">
        <view 
          class="question-text only-question"
          bindtouchstart="onTouchStart"
          bindtouchmove="onTouchMove"
          bindtouchend="onTouchEnd"
        >
          {{current.question}}
        </view>
      </block>
      <block wx:elif="{{showResult}}">
        <view class="question-text">{{current.question}}</view>
        <view class="answer-section show">
          <view class="separator"></view>
          <view class="answer-text">{{current.answer}}</view>
        </view>
      </block>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <block wx:if="{{!showResult}}">
        <view class="btn-wrapper btn-danger" bindtap="markResult" data-result="false">
          <view class="btn-text">没记住</view>
        </view>
        <view class="btn-wrapper btn-delete" bindtap="deleteCurrentKnowledge">
          <view class="btn-text">删除</view>
        </view>
        <view class="btn-wrapper btn-primary" bindtap="markResult" data-result="true">
          <view class="btn-text">记住了</view>
        </view>
      </block>
      <block wx:else>
        <view class="btn-wrapper btn-primary next-btn" bindtap="nextOne">
          <view class="btn-text">下一个</view>
        </view>
      </block>
    </view>
  </block>

  <!-- 空状态 -->
  <view class="empty-state review-empty" wx:else>
    <!-- 批次完成 -->
    <block wx:if="{{isBatchCompleted}}">
      <image class="empty-icon" src="/components/icons/completed.svg" mode="aspectFit"></image>
      <view class="empty-state-text">太棒了！本批复习已完成！</view>
      <view class="empty-state-secondary-text">还剩 {{fullReviewList.length - globalIndex}} 个待复习</view>
      <view class="btn-wrapper btn-primary continue-btn">
        <view class="btn-text">继续下一批</view>
        <button class="btn-action" bindtap="loadNextBatch"></button>
      </view>
    </block>
    <!-- 全部完成 -->
    <block wx:else>
      <image class="empty-icon" src="/components/icons/completed.svg" mode="aspectFit"></image>
      <view class="empty-state-text">{{currentGroup.name}}：本轮复习已完成！</view>
      <view class="btn-wrapper btn-primary mastered-list-btn">
        <view class="btn-text">已掌握列表</view>
        <button class="btn-action" bindtap="toMastered"></button>
      </view>
    </block>
  </view>

</view>
